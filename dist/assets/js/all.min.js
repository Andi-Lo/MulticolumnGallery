function addControllers(){var e=new ScrollController,t=new ResizeController;return galleryController={scrlCtrl:e,resizeCtrl:t},window.addEventListener("scroll",e.handleScroll,!0),window.addEventListener("resize",e.updateWidth,!1),window.addEventListener("resize",t.handleResize,!1),galleryController}function getColumnBuilder(){var e;return e in window&&"undefined"!=typeof e?e:e=new ColumnBuilder}var REQUEST_PENDING=2,REQUEST_SUCCESS=4,requestResult,galleryController;window.addEventListener("DOMContentLoaded",function(){var e=new GalleryFactory(getColumnBuilder());e.requestGallery()},!1);var GalleryFactory=function(e){this.colBuilder=e,this.hasColumns=-1,this.columns=0,this.names="",this.resize="",this.fadeIn="",this.columnHeight="",this.gallery=document.getElementById("gallery"),this.galleryWidth=gallery.offsetWidth,this.galleryHeight=gallery.offsetHeight,this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.sData={width:this.windowWidth,galleryWidth:this.galleryWidth};var t=function(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t.length>0&&(t+="&"),t+=encodeURI(i+"="+e[i]));return t};this.requestGallery=function(){var i=new XMLHttpRequest;return i.open("POST","php/Gallery.php",!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.onreadystatechange=function(){switch(i.readyState){case REQUEST_PENDING:document.getElementsByClassName("ajax-loading")[0].style.display="block";break;case REQUEST_SUCCESS:document.getElementsByClassName("ajax-loading")[0].style.display="none"}},i.onload=function(){if(i.status>=200&&i.status<400){var t=JSON.parse(i.responseText);requestResult=t,columns=t.numOfColumns,queries=t.mediaQueries,names=t.columnNames,resize=t.resize,fadeIn=t.fadeIn,columnHeight=t.columnHeight,activeColumn=t.activeColumn+"_Columns";for(var n=addControllers(),r=0;r<columns;r++)0===r?(e.buildColumn(names[r]),n.scrlCtrl.refreshScreen()):window.innerWidth>=queries[r]&&(e.buildColumn(activeColumn),n.scrlCtrl.refreshScreen());return!0}return!1},i.onerror=function(){return console.log("Ajax Error: "+err),!1},i.send(t(this.sData)),!0}},tmpColumn=-1,imgId=0,ColumnBuilder=function(){this.buildColumn=function(t){var i=t.split("_"),n=parseInt(i[0],10)-1,r=document.getElementById("gallery"),l=window.innerHeight+window.pageYOffset,o=r.getElementsByClassName("image");if(tmpColumn!=n){if(tmpColumn=n,r.setAttribute("style","height: "+columnHeight[n]+"px;"),0!==o.length)for(var s=o.length-1;s>=0;s--)o[s].remove();return requestResult[t].forEach(function(t){if("object"!=typeof t||null===t)return!1;var i;t.posY<=l?(i=e(t,"visible"),r.appendChild(i)):t.posY<=l+300&&t.posY<=l+900&&(i=e(t,"hidden"),r.appendChild(i))}),!0}};var e=function(e,t){var i=document.createElement("a"),n=document.createElement("img");return opacity="visible"==t?1:0,i.setAttribute("class","image"),i.setAttribute("href",e.imgPath),i.setAttribute("title",e.imgName),n.setAttribute("class","image-inner"),n.setAttribute("style","position:absolute; top:"+e.posY+"px; left:"+e.posX+"px; height:"+e.height+"px; width:"+e.width+"px; visibility:"+t+"; opacity: "+opacity+";"),n.setAttribute("src",e.thumbPath),n.setAttribute("height",e.height),n.setAttribute("width",e.width),i.appendChild(n),i};this.addImgToColumn=function(t,i){var n="";return gallery=document.getElementById("gallery"),requestResult[t].forEach(function(t){if("object"==typeof t&&null!==t&&t.id>imgId&&t.id-imgId<=1)if("1_Columns"==activeColumn&&t.posY<=i+300)n=e(t,"hidden"),gallery.appendChild(n),imgId=t.id;else{if(!(t.posY<=i+900))return;n=e(t,"hidden"),gallery.appendChild(n),imgId=t.id}}),!0}},ResizeController=function(){this.winWidth=window.innerWidth,this.winHeight=window.innerHeight,this.names=requestResult.columnNames,this.columns=requestResult.numOfColumns,this.queries=requestResult.mediaQueries,this.resize=requestResult.resize,this.columnBuilder=new ColumnBuilder};ResizeController.prototype.handleResize=function(){var e=galleryController.resizeCtrl,t=galleryController.scrlCtrl;if("yes"==e.resize){if(window.innerWidth<=e.queries[0])return getColumnBuilder().buildColumn(e.names[0]),void t.refreshScreen();if(window.innerWidth>=queries[queries.length-1])return getColumnBuilder().buildColumn(e.names[columns-1]),void t.refreshScreen();if(window.innerWidth>=queries[0])for(var i=0;i<=columns-1;i++)if(window.innerWidth<=queries[i])return getColumnBuilder().buildColumn(e.names[i-1]),void t.refreshScreen()}};var scrollPosSave=0,ScrollController=function(){this.scrollEvents=0,this.innerWinHeight=window.innerHeight,this.scrollHeight=this.innerWinHeight,this.isInit=!1,this.winWidth=window.innerWidth,this.timeoutId=0,this.names=requestResult.columnNames,this.fadeIn=function(e){e[0].style.opacity=0;var t=+new Date,i=function(){e[0].style.opacity=+e[0].style.opacity+(new Date-t)/400,t=+new Date,+e[0].style.opacity<1&&(window.requestAnimationFrame&&requestAnimationFrame(i)||setTimeout(i,16))};i()},this.refreshScreenOnScroll=function(e){for(var t=galleryController.scrlCtrl,i=requestResult.fadeIn,n=t.innerWinHeight+window.pageYOffset,r=document.getElementsByClassName("image-inner"),l=r.length-1;l>=0;l--){var o=window.getComputedStyle(r[l]),s=parseInt(o.getPropertyValue("top"),10),a=r[l].style.visibility;n-e>=s&&"NaN"!=s&&"hidden"==a&&(r[l].style.visibility="visible","yes"==i&&0==r[l].style.opacity&&t.fadeIn([r[l]]),scrollPosSave=n)}},this.refreshScreen=function(){for(var e=this.innerWinHeight+window.pageYOffset,t=document.getElementsByClassName("image-inner"),i=t.length-1;i>=0;i--){var n=window.getComputedStyle(t[i]),r=parseInt(n.getPropertyValue("top"),10);e>=r&&"NaN"!=r&&(t[i].style.visibility="visible",scrollPosSave=e)}}};ScrollController.prototype.updateWidth=function(){var e=galleryController.scrlCtrl;e.winWidth=window.innerWidth},ScrollController.prototype.handleScroll=function(){var e=galleryController.scrlCtrl,t=e.innerWinHeight+window.pageYOffset;t>scrollPosSave&&(e.scrollEvents++,window.innerWidth>767||e.isInit===!1?(e.isInit=!0,e.refreshScreenOnScroll(100)):(window.innerWidth<=768||e.isInit===!1)&&(e.scrollEvents=0,e.isInit=!0,e.refreshScreenOnScroll(30)),e.timeoutId&&clearTimeout(e.timeoutId),e.timeoutId=setTimeout(function(){getColumnBuilder().addImgToColumn(e.names[tmpColumn],t),e.refreshScreenOnScroll(30)},50))};